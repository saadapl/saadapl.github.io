!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanilla={})}(this,(function(n){"use strict";var r=0;function e(n){return n(this)}function t(n,r,e){return r(this,"function"==typeof e?e(n(this)):e)}function a(n,r){(null==r||r>n.length)&&(r=n.length);for(var e=0,t=Array(r);e<r;e++)t[e]=n[e];return t}function o(n,r){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,r){if(n){if("string"==typeof n)return a(n,r);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(n,r):void 0}}(n))||r){e&&(n=e);var t=0;return function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=function(n,r){return n.unstable_is?n.unstable_is(r):r===n},l=function(n){return"init"in n},f=function(n){return!!n.write},v=new WeakMap,c=function(n){var r;return d(n)&&!(null!=(r=v.get(n))&&r[1])},d=function(n){return"function"==typeof(null==n?void 0:n.then)},s=function(n){return"v"in n||"e"in n},y=function(n){if("e"in n)throw n.e;return n.v},h=function(n,r,e){e.p.has(n)||(e.p.add(n),r.then((function(){e.p.delete(n)}),(function(){e.p.delete(n)})))},p=Symbol.for("JOTAI.EXPERIMENTAL.FLUSHSTOREHOOK"),m=function(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var t=r[0],a=r[1],u=r[2],w=r[3],g=r[4],b=r[5],A=function(n){var r=t(n);return r||(r={d:new Map,p:new Set,n:0},a(n,r),null==g||g(n,R)),r},S=new WeakMap,E=new Map,k=new Set,M=new Set,I=function(){var n=[],r=function(r){try{r()}catch(r){n.push(r)}},e=function(){var n,e;null==(n=(e=R)[p])||n.call(e);var t=new Set,a=t.add.bind(t);E.forEach((function(n){var r;return null==(r=n.m)?void 0:r.l.forEach(a)})),E.clear(),k.forEach(a),k.clear(),M.forEach(a),M.clear(),t.forEach(r),E.size&&C()};do{e()}while(E.size||k.size||M.size);if(n.length)throw n[0]},O=function(n,r,e){var t,a,u,i="v"in r,l=r.v,f=c(r.v)?r.v:null;if(d(e)){!function(n){if(!v.has(n)){var r=[new Set,!1];v.set(n,r);var e=function(){r[1]=!0};n.then(e,e),n.onCancel=function(n){r[0].add(n)}}}(e);for(var s,y=o(r.d.keys());!(s=y()).done;){var p=s.value;h(n,e,A(p))}r.v=e}else r.v=e;delete r.e,i&&Object.is(l,r.v)||(++r.n,f&&(t=f,a=e,(u=v.get(t))&&(u[1]=!0,u[0].forEach((function(n){return n(a)})))))},T=function(n){var r=A(n);if(s(r)){if(r.m&&S.get(n)!==r.n)return r;if(Array.from(r.d).every((function(n){var r=n[0],e=n[1];return T(r).n===e})))return r}r.d.clear();var e,t,a=!0,o=function(){r.m&&(x(n,r),C(),I())},v={get signal(){return e||(e=new AbortController),e.signal},get setSelf(){return!t&&f(n)&&(t=function(){if(!a){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return _.apply(void 0,[n].concat(e))}}),t}};try{var p=u(n,(function(e){if(i(n,e)){var t=A(e);if(!s(t)){if(!l(e))throw new Error("no atom init");O(e,t,e.init)}return y(t)}var u=T(e);try{return y(u)}finally{!function(n,r,e,t){var a;r.d.set(e,t.n),c(r.v)&&h(n,r.v,t),null==(a=t.m)||a.t.add(n)}(n,r,e,u),a||o()}}),v);return O(n,r,p),d(p)&&(null==p.onCancel||p.onCancel((function(){var n;return null==(n=e)?void 0:n.abort()})),p.then(o,o)),r}catch(n){return delete r.v,r.e=n,++r.n,r}finally{a=!1}},j=function(n){for(var r,e=new Map,t=o((null==(a=n.m)?void 0:a.t)||[]);!(r=t()).done;){var a,u=r.value,i=A(u);i.m&&e.set(u,i)}for(var l,f=o(n.p);!(l=f()).done;){var v=l.value;e.set(v,A(v))}return e},z=function(n){for(var r=[n];r.length;)for(var e,t=r.pop(),a=o(j(t));!(e=a()).done;){var u=e.value,i=u[0],l=u[1];S.has(i)||(S.set(i,l.n),r.push(l))}},C=function(){for(var n=[],r=new WeakSet,e=new WeakSet,t=Array.from(E);t.length;){var a=t[t.length-1],u=a[0],i=a[1];if(e.has(u))t.pop();else if(r.has(u))S.get(u)===i.n?n.push([u,i,i.n]):(S.delete(u),E.set(u,i)),e.add(u),t.pop();else{r.add(u);for(var l,f=o(j(i));!(l=f()).done;){var v=l.value,c=v[0],d=v[1];r.has(c)||t.push([c,d])}}}for(var s=n.length-1;s>=0;--s){for(var y,h=n[s],p=h[0],m=h[1],w=h[2],g=!1,b=o(m.d.keys());!(y=b()).done;){var A=y.value;if(A!==p&&E.has(A)){g=!0;break}}g&&(T(p),x(p,m),w!==m.n&&(E.set(p,m),null==m.u||m.u())),S.delete(p)}},W=function(n){var r=!0;try{for(var e=arguments.length,t=new Array(e>1?e-1:0),a=1;a<e;a++)t[a-1]=arguments[a];return w.apply(void 0,[n,function(n){return y(T(n))},function(e){var t=A(e);try{for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];if(i(n,e)){if(!l(e))throw new Error("atom not writable");var f=t.n,v=o[0];return O(e,t,v),x(e,t),void(f!==t.n&&(E.set(e,t),null==t.u||t.u(),z(t)))}return W.apply(void 0,[e].concat(o))}finally{r||(C(),I())}}].concat(t))}finally{r=!1}},_=function(n){try{for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return W.apply(void 0,[n].concat(e))}finally{C(),I()}},x=function(n,r){if(r.m&&!c(r.v)){for(var e,t=o(r.d);!(e=t()).done;){var a=e.value,u=a[0],i=a[1];if(!r.m.d.has(u)){var l=A(u);H(u,l).t.add(n),r.m.d.add(u),i!==l.n&&(E.set(u,l),null==l.u||l.u(),z(l))}}for(var f,v=o(r.m.d||[]);!(f=v()).done;){var d=f.value;if(!r.d.has(d)){r.m.d.delete(d);var s=L(d,A(d));null==s||s.t.delete(n)}}}},H=function(n,r){if(!r.m){T(n);for(var e,t=o(r.d.keys());!(e=t()).done;){var a=e.value;H(a,A(a)).t.add(n)}if(r.m={l:new Set,d:new Set(r.d.keys()),t:new Set},null==r.h||r.h(),f(n)){var u=r.m;M.add((function(){var r=!0;try{var e=b(n,(function(){try{for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return W.apply(void 0,[n].concat(t))}finally{r||(C(),I())}}));e&&(u.u=function(){r=!0;try{e()}finally{r=!1}})}finally{r=!1}}))}}return r.m},L=function(n,r){if(!r.m||r.m.l.size||Array.from(r.m.t).some((function(r){var e;return null==(e=A(r).m)?void 0:e.d.has(n)})))return r.m;var e=r.m.u;e&&k.add(e),delete r.m,null==r.h||r.h();for(var t,a=o(r.d.keys());!(t=a()).done;){var u=t.value,i=L(u,A(u));null==i||i.t.delete(n)}},R={get:function(n){return y(T(n))},set:_,sub:function(n,r){var e=A(n),t=H(n,e).l;return t.add(r),I(),function(){t.delete(r),L(n,e),I()}},unstable_derive:function(n){return m.apply(void 0,n.apply(void 0,r))}};return R},w=function(){var n=new WeakMap,r=m((function(r){return n.get(r)}),(function(r,e){return n.set(r,e).get(r)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.read.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.write.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return null==n.unstable_onInit?void 0:n.unstable_onInit.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return null==n.onMount?void 0:n.onMount.apply(n,e)}));return r};n.atom=function(n,a){var o="atom"+ ++r,u={toString:function(){return o}};return"function"==typeof n?u.read=n:(u.init=n,u.read=e,u.write=t),a&&(u.write=a),u},n.createStore=w,n.getDefaultStore=function(){return u||(u=w()),u}}));
